<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOD Generator | COACH CHRIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-page: #f3f4f6;
            --bg-card: #ffffff;
            --border-color: #e5e7eb;
            --text-main: #1f2937;
            --text-heading: #000000;
            --text-muted: #9ca3af;
            --text-accent: #6b7280;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --bg-toggle: #f3f4f6;
            --toggle-pill-bg: #e5e7eb;
            --bg-btn-primary: #000000;
            --btn-text-primary: #ffffff;
            --bg-output: #f9fafb;
            --modal-overlay: rgba(0, 0, 0, 0.4);
            --launch-overlay: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] {
            --bg-page: #0a0a0a;
            --bg-card: #121212;
            --border-color: #262626;
            --text-main: #ffffff;
            --text-heading: #ffffff;
            --text-muted: #525252;
            --text-accent: #a3a3a3;
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            --bg-toggle: #1a1a1a;
            --toggle-pill-bg: #1a1a1a;
            --bg-btn-primary: #ffffff;
            --btn-text-primary: #000000;
            --bg-output: #1a1a1a;
            --modal-overlay: rgba(0, 0, 0, 0.8);
            --launch-overlay: rgba(10, 10, 10, 0.95);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .font-brand { font-family: 'Oswald', sans-serif; }

        .app-card {
            background-color: var(--bg-card);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .theme-switch-container {
            position: relative;
            width: 44px;
            height: 22px;
            background-color: var(--toggle-pill-bg);
            border-radius: 100px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 2px;
            border: 1px solid var(--border-color);
        }

        .theme-switch-circle {
            position: absolute;
            left: 2px;
            width: 16px;
            height: 16px;
            background-color: var(--bg-btn-primary);
            border-radius: 50%;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        [data-theme="dark"] .theme-switch-circle { transform: translateX(22px); }

        .kit-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .kit-option input { display: none; }
        .kit-option:has(input:checked) {
            background-color: var(--bg-btn-primary);
            color: var(--btn-text-primary);
            border-color: var(--bg-btn-primary);
        }

        #wod-movements {
            background-color: var(--bg-output);
            border: 1px solid var(--border-color);
            color: var(--text-main);
        }

        .movement-line {
            display: block;
            line-height: 2.4;
            border-bottom: 1px solid var(--border-color);
            padding: 4px 0;
        }
        .movement-line:last-child { border-bottom: none; }

        .kit-tag {
            background-color: var(--bg-toggle);
            color: var(--text-heading);
            font-size: 10px;
            font-weight: 800;
            padding: 4px 10px;
            border-radius: 99px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-generate {
            background-color: var(--bg-btn-primary);
            color: var(--btn-text-primary);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            background-color: var(--modal-overlay);
            backdrop-filter: blur(8px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .modal-content {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            width: 100%;
            max-width: 30rem;
            border-radius: 2.5rem;
            padding: 2.5rem;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-overlay.active .modal-content { transform: scale(1); }

        #launch-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            background-color: var(--launch-overlay);
            backdrop-filter: blur(12px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #launch-overlay.active { display: flex; opacity: 1; }

        @keyframes pulse-scale {
            0% { transform: scale(0.85); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.85); opacity: 0.3; }
        }

        #launch-icon-container { animation: pulse-scale 1.2s infinite ease-in-out; }

        .hidden-initial { display: none; }

        .intensity-pill {
            font-size: 9px;
            font-weight: 900;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4" data-theme="light">

    <div id="launch-overlay">
        <div id="launch-icon-container" style="color: var(--text-heading)">
            <i data-lucide="zap" class="w-16 h-16"></i>
        </div>
        <p id="loading-text" class="mt-4 font-brand font-bold text-xl uppercase tracking-widest text-center px-8" style="color: var(--text-heading)">Analyzing Systems</p>
    </div>

    <!-- HELP MODAL -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content shadow-2xl">
            <button id="close-modal" class="absolute top-6 right-6 p-2 rounded-full hover:opacity-70 transition-opacity" style="color: var(--text-muted)">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <div class="flex flex-col">
                <div class="flex items-center gap-4 mb-6">
                    <div class="p-3 rounded-2xl" style="background-color: var(--bg-toggle)">
                        <i data-lucide="info" class="w-6 h-6" style="color: var(--text-heading)"></i>
                    </div>
                    <div>
                        <h3 class="font-brand font-bold text-2xl uppercase leading-none" style="color: var(--text-heading)">The Framework</h3>
                        <p class="text-[10px] font-bold uppercase tracking-widest opacity-60" style="color: var(--text-accent)">Modular Session Generation</p>
                    </div>
                </div>

                <div class="space-y-6 text-xs leading-relaxed" style="color: var(--text-accent)">
                    <section>
                        <h4 class="font-black uppercase tracking-widest mb-2 text-[11px]" style="color: var(--text-heading)">1. Movement Pillars</h4>
                        <p>Workouts are built across 5 specific pillars: Full Body Power, Upper Push/Pull, Lower Strength, Core Stability, and Metabolic Conditioning. This ensures balanced structural integrity in every session.</p>
                    </section>

                    <section>
                        <h4 class="font-black uppercase tracking-widest mb-2 text-[11px]" style="color: var(--text-heading)">2. Time Optimization</h4>
                        <p>Every session is calculated to fit a 15-30 minute window. For AMRAP and EMOM formats, the duration is set. For "For Time" and "Chipper" formats, a recommended time-cap is calculated based on movement complexity.</p>
                    </section>

                    <section>
                        <h4 class="font-black uppercase tracking-widest mb-2 text-[11px]" style="color: var(--text-heading)">3. Supplemental Gear</h4>
                        <p>By selecting equipment, you unlock specific movement pools. If "Single Kettlebell" is unchecked, the system defaults to pure bodyweight alternatives to ensure you can always train anywhere.</p>
                    </section>

                    <section class="p-4 rounded-2xl border border-dashed" style="background-color: var(--bg-toggle); border-color: var(--border-color)">
                        <h4 class="font-black uppercase tracking-widest mb-2 text-[11px]" style="color: var(--text-heading)">Coaching Advice</h4>
                        <p class="italic text-[10px]">"Consistency beats intensity in the long run. If a session feels too heavy, reduce the reps by 20% and focus on the quality of movement. Breathe nasally during your rest periods."</p>
                    </section>
                </div>

                <button id="modal-confirm" class="w-full mt-8 py-4 font-black uppercase tracking-widest rounded-2xl text-xs" style="background-color: var(--bg-btn-primary); color: var(--btn-text-primary)">Return to Training</button>
            </div>
        </div>
    </div>

    <div class="app-card w-full max-w-md rounded-[2.5rem] overflow-hidden flex flex-col items-center p-8 space-y-8">
        
        <header class="w-full flex justify-between items-start">
            <div class="flex flex-col select-none">
                <h1 class="font-brand font-bold text-4xl leading-none tracking-wide mb-1" style="color: var(--text-heading)">COACH CHRIS</h1>
                <h2 class="font-brand font-bold text-lg leading-none mb-[2px]" style="color: var(--text-accent)">CIRCULAR ROOTS COACHING</h2>
                <h3 class="font-brand font-bold text-lg leading-none uppercase" style="color: var(--text-muted)">Train Uncnvntnl</h3>
            </div>
            
            <div class="flex flex-col items-center gap-3">
                <div class="flex flex-col items-center gap-1.5">
                    <span class="text-[9px] font-black uppercase tracking-widest opacity-60" style="color: var(--text-muted)">Theme</span>
                    <div id="theme-toggle" class="theme-switch-container">
                        <div class="theme-switch-circle"></div>
                    </div>
                </div>
                <button id="open-info" class="p-2 rounded-xl transition-all duration-300 hover:scale-110 active:scale-95 flex items-center justify-center" style="background-color: var(--bg-toggle); color: var(--text-heading)">
                    <i data-lucide="help-circle" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- SETUP SCREEN -->
        <div id="home-state" class="w-full text-center space-y-6 py-4">
            <div class="space-y-2">
                <h2 class="font-brand font-bold text-4xl uppercase tracking-tight" style="color: var(--text-heading)">WOD Generator</h2>
                <p class="text-xs font-bold uppercase tracking-widest px-4 py-2 flex items-center justify-center gap-2 rounded-full mx-auto w-fit" style="background-color: var(--bg-toggle); color: var(--text-accent)">
                    <i data-lucide="clock" class="w-3 h-3"></i> 15 - 30 MIN SESSIONS
                </p>
            </div>
            
            <div class="rounded-3xl p-6 border border-dashed space-y-4" style="background-color: var(--bg-toggle); border-color: var(--border-color)">
                <div class="space-y-4">
                    <div class="p-4 rounded-2xl flex items-center justify-between" style="background-color: var(--bg-btn-primary); color: var(--btn-text-primary)">
                        <div class="flex flex-col items-start">
                            <span class="text-xs font-bold uppercase tracking-widest">Bodyweight Foundation</span>
                            <span class="text-[9px] font-black opacity-60 uppercase tracking-tighter">Essential movements included</span>
                        </div>
                        <i data-lucide="shield" class="w-5 h-5"></i>
                    </div>

                    <div class="flex items-center gap-3 pt-1">
                        <div class="h-[1px] flex-1 bg-gray-300 dark:bg-gray-700 opacity-30"></div>
                        <span class="text-[10px] font-black uppercase tracking-widest opacity-40">Supplemental Kit</span>
                        <div class="h-[1px] flex-1 bg-gray-300 dark:bg-gray-700 opacity-30"></div>
                    </div>

                    <div class="grid grid-cols-1 gap-2">
                        <label class="kit-option p-4 rounded-2xl text-[11px] font-bold uppercase tracking-wider">
                            <input type="checkbox" name="kit-select" value="kettlebell" checked>
                            Single Kettlebell
                        </label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="kit-option p-4 rounded-2xl text-[11px] font-bold uppercase tracking-wider">
                                <input type="checkbox" name="kit-select" value="run">
                                Run Space
                            </label>
                            <label class="kit-option p-4 rounded-2xl text-[11px] font-bold uppercase tracking-wider">
                                <input type="checkbox" name="kit-select" value="pullup">
                                Pull Up Bar
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="wod-card" class="w-full space-y-5 hidden-initial opacity-0 transition-opacity duration-500">
            <div class="flex items-center justify-between">
                <div id="kit-section" class="space-y-2">
                    <span class="text-[10px] font-black uppercase tracking-widest" style="color: var(--text-muted)">Kit Required</span>
                    <div id="kit-container" class="flex flex-wrap gap-2"></div>
                </div>
                <button id="reset-button" class="p-2.5 rounded-2xl transition-all duration-300 hover:scale-105 active:scale-95 flex items-center justify-center border border-dashed" style="background-color: var(--bg-toggle); color: var(--text-accent); border-color: var(--border-color)">
                    <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
                </button>
            </div>

            <div class="space-y-4">
                <div class="flex items-start justify-between">
                    <div class="flex flex-col gap-1">
                        <span id="wod-format-name" class="text-3xl font-black uppercase tracking-tighter leading-none" style="color: var(--text-heading)"></span>
                        <span id="wod-format-desc" class="text-[10px] font-bold uppercase tracking-widest" style="color: var(--text-accent)"></span>
                    </div>
                    <span id="intensity-indicator" class="intensity-pill"></span>
                </div>

                <div id="wod-movements" class="w-full p-5 rounded-3xl text-sm"></div>

                <div class="flex items-center justify-between">
                    <div id="wod-time-cap" class="text-[10px] font-black uppercase tracking-widest px-4 py-2 rounded-full flex items-center gap-2" style="background-color: var(--bg-toggle); color: var(--text-heading)">
                        <i data-lucide="timer" class="w-3 h-3"></i>
                        <span id="time-cap-value"></span>
                    </div>
                    <button id="copy-button" class="flex items-center gap-2 text-[10px] font-black uppercase tracking-widest hover:opacity-70" style="color: var(--text-accent)">
                        <i data-lucide="copy" class="w-3 h-3"></i> Share
                    </button>
                </div>
            </div>

            <div id="instructional-section" class="pt-6 border-t space-y-4" style="border-color: var(--border-color)">
                <h3 class="text-xs font-black uppercase tracking-widest" style="color: var(--text-muted)">Execution Strategy</h3>
                <div id="instruction-content" class="space-y-3"></div>
            </div>
        </div>

        <button id="generate-button" class="btn-generate w-full py-5 font-brand font-bold text-xl uppercase tracking-widest rounded-3xl shadow-lg">
            Build My Session
        </button>
    </div>

    <script type="module">
        lucide.createIcons();

        const PILLARS = {
            full_body: [
                { name: "SA KB Long Cycle", type: "power", unilateral: "switch", baseReps: 8, kit: "kettlebell", intensity: "high" },
                { name: "SA KB Thrusters", type: "power", unilateral: "switch", baseReps: 10, kit: "kettlebell", intensity: "high" },
                { name: "SA KB Cluster", type: "power", unilateral: "switch", baseReps: 6, kit: "kettlebell", intensity: "high" },
                { name: "Burpees", type: "cardio", unilateral: null, baseReps: 12, kit: "bodyweight", intensity: "moderate" },
                { name: "SA KB Clean & Press", type: "power", unilateral: "switch", baseReps: 8, kit: "kettlebell", intensity: "moderate" }
            ],
            upper: [
                { name: "SA KB Strict Press", type: "strength", unilateral: "switch", baseReps: 8, kit: "kettlebell", intensity: "moderate" },
                { name: "Push-ups", type: "strength", unilateral: null, baseReps: 15, kit: "bodyweight", intensity: "moderate" },
                { name: "SA KB Row", type: "strength", unilateral: "switch", baseReps: 12, kit: "kettlebell", intensity: "low" },
                { name: "Pull Ups", type: "strength", unilateral: null, baseReps: 8, kit: "pullup", intensity: "high" }
            ],
            lower: [
                { name: "KB Goblet Squats", type: "strength", unilateral: null, baseReps: 15, kit: "kettlebell", intensity: "moderate" },
                { name: "2H KB Swings", type: "power", unilateral: null, baseReps: 20, kit: "kettlebell", intensity: "moderate" },
                { name: "KB Goblet Lunges", type: "strength", unilateral: "alt", baseReps: 16, kit: "kettlebell", intensity: "moderate" },
                { name: "Air Squats", type: "strength", unilateral: null, baseReps: 25, kit: "bodyweight", intensity: "low" }
            ],
            core: [
                { name: "SA KB Plank Drags", type: "stability", unilateral: "alt", baseReps: 12, kit: "kettlebell", intensity: "low" },
                { name: "Hanging Leg Raises", type: "stability", unilateral: null, baseReps: 12, kit: "pullup", intensity: "moderate" },
                { name: "Plank Shoulder Taps", type: "stability", unilateral: "alt", baseReps: 30, kit: "bodyweight", intensity: "low" },
                { name: "Hollow Body Holds", type: "stability", unilateral: null, baseReps: 30, kit: "bodyweight", isTimeBased: true, intensity: "moderate" }
            ],
            conditioning: [
                { name: "Run 400m", type: "distance", unilateral: null, baseReps: 1, kit: "run", intensity: "moderate" },
                { name: "SA KB Snatches", type: "power", unilateral: "switch", baseReps: 12, kit: "kettlebell", intensity: "high" },
                { name: "Mountain Climbers", type: "cardio", unilateral: "alt", baseReps: 40, kit: "bodyweight", intensity: "moderate" },
                { name: "Jump Squats", type: "power", unilateral: null, baseReps: 12, kit: "bodyweight", intensity: "high" }
            ]
        };

        const FORMATS = [
            { name: "AMRAP", style: "Aerobic Capacity & Pacing", howTo: ["Start your timer. Perform movements A through E for prescribed reps.", "Once finished, immediately return to movement A.", "Complete as many full cycles as possible before time runs out."] },
            { name: "ROUNDS FOR TIME", style: "High Intensity Benchmark", howTo: ["Perform the entire list of movements in order. This equals ONE round.", "Repeat this cycle for the total number of rounds specified.", "Stop your clock once the final rep of the final round is complete."] },
            { name: "EMOM", style: "Skill & Power Output", howTo: ["Minute 1: Perform Movement A. Rest for the remainder of that minute.", "Minute 2: Perform Movement B. Rest for the remainder.", "Continue rotating through the list on each subsequent minute."] },
            { name: "CHIPPER", style: "Mental Resilience", howTo: ["Complete all reps for Movement A before looking at Movement B.", "Work through the list until the very last rep of the last exercise is done.", "Stay movingâ€”short rests are better than long ones."] }
        ];

        const LOADING_PHRASES = [
            "Analyzing Systems...",
            "Preparing Session...",
            "Calculating Stimulus...",
            "Optimizing Movements...",
            "Setting Intention...",
            "Building Foundation...",
            "Finding the Limit...",
            "Drafting Strategy..."
        ];

        const body = document.body;
        const themeToggle = document.getElementById('theme-toggle');
        const generateButton = document.getElementById('generate-button');
        const resetButton = document.getElementById('reset-button');
        const copyButton = document.getElementById('copy-button');
        const wodCard = document.getElementById('wod-card');
        const homeState = document.getElementById('home-state');
        const wodFormatName = document.getElementById('wod-format-name');
        const wodFormatDesc = document.getElementById('wod-format-desc');
        const wodMovements = document.getElementById('wod-movements');
        const timeCapValue = document.getElementById('time-cap-value');
        const instructionContent = document.getElementById('instruction-content');
        const kitContainer = document.getElementById('kit-container');
        const launchOverlay = document.getElementById('launch-overlay');
        const loadingText = document.getElementById('loading-text');
        const intensityIndicator = document.getElementById('intensity-indicator');

        themeToggle.addEventListener('click', () => {
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        });

        function calculateReps(move, formatName) {
            const { baseReps, type, unilateral, isTimeBased } = move;
            let finalReps = baseReps;
            const activeUni = Array.isArray(unilateral) ? unilateral[0] : unilateral;

            if (isTimeBased) return `${baseReps} Seconds`;
            if (formatName === "CHIPPER") {
                if (type === "distance") return "Complete 1km";
                finalReps = type === "power" ? 30 : 50;
            } else if (formatName === "EMOM") {
                if (type === "distance") return "Run 1 Min";
                finalReps = Math.ceil(baseReps * 0.85);
            }

            if (activeUni) {
                const tag = activeUni === 'alt' ? ' (Alt)' : ' (Switch Half)';
                return `${finalReps}${tag}`;
            }
            return finalReps;
        }

        function generateWOD() {
            const selectedKit = Array.from(document.querySelectorAll('input[name="kit-select"]:checked')).map(cb => cb.value);
            const activeKits = ["bodyweight", ...selectedKit];

            loadingText.textContent = LOADING_PHRASES[Math.floor(Math.random() * LOADING_PHRASES.length)];
            generateButton.disabled = true;
            launchOverlay.classList.add('active');
            
            setTimeout(() => {
                const format = FORMATS[Math.floor(Math.random() * FORMATS.length)];
                let kitUsed = new Set();
                let intensities = [];
                let rounds = 1;

                if (format.name === "ROUNDS FOR TIME") {
                    rounds = Math.floor(Math.random() * 3) + 3; // Generates 3, 4, or 5
                    wodFormatName.textContent = `${rounds} ROUNDS FOR TIME`;
                } else {
                    wodFormatName.textContent = format.name;
                }
                
                wodFormatDesc.textContent = format.style;
                wodMovements.innerHTML = '';

                let moveIndex = 0;
                Object.keys(PILLARS).forEach(cat => {
                    const pool = PILLARS[cat].filter(m => activeKits.includes(m.kit));
                    if (pool.length > 0) {
                        const move = pool[Math.floor(Math.random() * pool.length)];
                        kitUsed.add(move.kit);
                        intensities.push(move.intensity);
                        
                        const displayReps = calculateReps(move, format.name);
                        const line = document.createElement('div');
                        line.className = 'movement-line';
                        line.innerHTML = `<span>${String.fromCharCode(65 + moveIndex)})</span> <strong>${move.name.toUpperCase()}</strong> : <em>${displayReps}</em>`;
                        wodMovements.appendChild(line);
                        moveIndex++;
                    }
                });

                const highCount = intensities.filter(i => i === 'high').length;
                let finalIntensity = 'Moderate Effort';
                let intensityColor = '#f59e0b';
                let intensityFactor = 1.0;
                
                if (highCount >= 3) { 
                    finalIntensity = 'High Intensity'; 
                    intensityColor = '#ef4444';
                    intensityFactor = 1.2;
                } else if (highCount <= 1) { 
                    finalIntensity = 'Low Intensity'; 
                    intensityColor = '#10b981';
                    intensityFactor = 0.8;
                }
                
                intensityIndicator.textContent = finalIntensity;
                intensityIndicator.style.backgroundColor = intensityColor;
                intensityIndicator.style.color = '#fff';

                // TIME CAP CALCULATION (Guarantee 15-30 mins)
                let cap = "20:00";
                if (format.name === "AMRAP") {
                    cap = Math.random() > 0.5 ? "20:00" : "15:00";
                } else if (format.name === "EMOM") {
                    const moveCount = wodMovements.children.length;
                    const emomRounds = Math.floor(20 / moveCount); 
                    cap = `${emomRounds * moveCount}:00`;
                } else if (format.name === "CHIPPER") {
                    const mins = Math.round(24 * intensityFactor);
                    cap = `${Math.min(30, Math.max(15, mins))}:00`;
                } else if (format.name === "ROUNDS FOR TIME") {
                    const minsPerRound = 5 * intensityFactor;
                    const totalMins = Math.round(rounds * minsPerRound);
                    cap = `${Math.min(30, Math.max(15, totalMins))}:00`;
                }
                timeCapValue.textContent = `${cap} CAP`;

                kitContainer.innerHTML = '';
                kitUsed.forEach(k => {
                    const l = k === 'kettlebell' ? 'KB' : k === 'run' ? 'Run' : k === 'pullup' ? 'Pull Up' : 'Body';
                    const tag = document.createElement('div');
                    tag.className = 'kit-tag';
                    tag.innerHTML = `<i data-lucide="check" class="w-3 h-3"></i> ${l}`;
                    kitContainer.appendChild(tag);
                });

                instructionContent.innerHTML = '';
                const focusBox = document.createElement('div');
                focusBox.className = 'flex items-center gap-2 p-3 rounded-xl mb-3 text-[10px] font-black uppercase tracking-widest';
                focusBox.style.backgroundColor = 'var(--bg-btn-primary)';
                focusBox.style.color = 'var(--btn-text-primary)';
                focusBox.innerHTML = `<i data-lucide="target" class="w-4 h-4"></i> Focus: ${format.style}`;
                instructionContent.appendChild(focusBox);

                format.howTo.forEach(text => {
                    const p = document.createElement('p');
                    p.className = 'p-3 rounded-xl text-[11px] border border-dashed';
                    p.style.backgroundColor = 'var(--bg-toggle)';
                    p.style.borderColor = 'var(--border-color)';
                    p.style.color = 'var(--text-accent)';
                    p.textContent = text;
                    instructionContent.appendChild(p);
                });

                homeState.classList.add('hidden');
                wodCard.classList.remove('hidden-initial');
                launchOverlay.classList.remove('active');
                
                setTimeout(() => {
                    wodCard.classList.remove('opacity-0');
                    generateButton.textContent = "Rebuild Session";
                    generateButton.disabled = false;
                    lucide.createIcons();
                }, 50);
            }, 800);
        }

        generateButton.addEventListener('click', generateWOD);
        resetButton.addEventListener('click', () => {
            wodCard.classList.add('opacity-0');
            setTimeout(() => {
                wodCard.classList.add('hidden-initial');
                homeState.classList.remove('hidden');
                generateButton.textContent = "Build My Session";
            }, 300);
        });

        copyButton.addEventListener('click', () => {
            const cleanMovements = Array.from(wodMovements.querySelectorAll('.movement-line')).map(l => l.innerText).join('\n');
            const text = `WOD: ${wodFormatName.textContent} (${timeCapValue.textContent})\n${cleanMovements}\n\nCOACH CHRIS`;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            copyButton.textContent = 'Copied!';
            setTimeout(() => copyButton.textContent = 'Share', 1500);
        });

        document.getElementById('open-info').addEventListener('click', () => document.getElementById('modal-overlay').classList.add('active'));
        document.getElementById('close-modal').addEventListener('click', () => document.getElementById('modal-overlay').classList.remove('active'));
        document.getElementById('modal-confirm').addEventListener('click', () => document.getElementById('modal-overlay').classList.remove('active'));
    </script>
</body>
</html>

